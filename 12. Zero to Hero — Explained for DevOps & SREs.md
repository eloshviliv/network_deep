# áƒ“áƒ¦áƒ” 12 â€” Netfilter, iptables & nftables: Linux-áƒ˜áƒ¡ Firewall áƒ¢áƒ•áƒ˜áƒœáƒ˜

áƒ¦áƒ áƒ›áƒ áƒ©áƒáƒ«áƒ˜áƒ áƒ•áƒ áƒ˜áƒ›áƒáƒ¨áƒ˜, áƒ—áƒ£ áƒ áƒáƒ’áƒáƒ  áƒ¤áƒ˜áƒšáƒ¢áƒ áƒáƒ•áƒ¡, áƒªáƒ•áƒšáƒ˜áƒ¡, áƒ’áƒáƒ“áƒáƒ¡áƒªáƒ”áƒ›áƒ¡, NAT-áƒ¡ áƒáƒ™áƒ”áƒ—áƒ”áƒ‘áƒ¡ áƒ“áƒ áƒ¬áƒ§áƒ•áƒ”áƒ¢áƒ¡ áƒ§áƒáƒ•áƒ”áƒšáƒ˜ áƒáƒáƒ™áƒ”áƒ¢áƒ˜áƒ¡ áƒ‘áƒ”áƒ“áƒ¡ Linux-áƒ˜.

![alt text](photo2/image-30.png)

## áƒ áƒáƒ¢áƒáƒ› áƒáƒ áƒ˜áƒ¡ áƒ”áƒ¡ áƒ—áƒ”áƒ›áƒ áƒ£áƒ™áƒ˜áƒ“áƒ£áƒ áƒ”áƒ¡áƒáƒ“ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ•áƒáƒœáƒ˜

áƒ—áƒ£ áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ—:
- Linux áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ”áƒ‘áƒ—áƒáƒœ
- Kubernetes áƒ™áƒšáƒáƒ¡áƒ¢áƒ”áƒ áƒ”áƒ‘áƒ—áƒáƒœ
- Docker áƒ™áƒáƒœáƒ¢áƒ”áƒ˜áƒœáƒ”áƒ áƒ”áƒ‘áƒ—áƒáƒœ
- Cloud VPC-áƒ”áƒ‘áƒ—áƒáƒœ
- Firewalls-áƒ—áƒáƒœ
- NAT áƒ’áƒ”áƒ˜áƒ—áƒ•áƒ”áƒ˜áƒ”áƒ‘áƒ—áƒáƒœ
- Load Balancers-áƒ—áƒáƒœ
- áƒ›áƒ˜áƒ™áƒ áƒáƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ”áƒ‘áƒ—áƒáƒœ

**áƒ›áƒáƒ¨áƒ˜áƒœ áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ£áƒ™áƒ•áƒ” áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ— Netfilter-áƒ¡ â€” áƒ—áƒ£áƒœáƒ“áƒáƒª áƒáƒ  áƒ˜áƒªáƒáƒ“áƒ”áƒ—.**

Netfilter áƒáƒ áƒ˜áƒ¡ kernel-áƒ˜áƒ¡ áƒ“áƒáƒœáƒ˜áƒ¡ áƒ¢áƒ•áƒ˜áƒœáƒ˜, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ¬áƒ§áƒ•áƒ”áƒ¢áƒ¡:
- áƒœáƒ”áƒ‘áƒáƒ“áƒáƒ áƒ—áƒ£áƒšáƒ˜áƒ áƒ—áƒ£ áƒáƒ áƒ áƒ”áƒ¡ áƒáƒáƒ™áƒ”áƒ¢áƒ˜?
- áƒ£áƒœáƒ“áƒ áƒ›áƒáƒ’áƒ“áƒ”áƒ¡?
- áƒ£áƒœáƒ“áƒ áƒ’áƒáƒ˜áƒ™áƒ”áƒ—áƒáƒ¡ NAT?
- áƒ£áƒœáƒ“áƒ áƒ’áƒáƒ“áƒáƒ˜áƒ’áƒ–áƒáƒ•áƒœáƒáƒ¡?
- áƒ£áƒœáƒ“áƒ áƒ’áƒáƒ“áƒáƒ˜áƒ¬áƒ”áƒ áƒáƒ¡?

- **Netfilter** â†’ áƒ«áƒ˜áƒ áƒ˜áƒ—áƒáƒ“áƒ˜ firewall áƒ«áƒ áƒáƒ•áƒ
- **iptables/nftables** â†’ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ API-áƒ”áƒ‘áƒ˜ áƒ›áƒ˜áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡

áƒ“áƒ¦áƒ”áƒ¡ áƒ’áƒáƒ•áƒ˜áƒ’áƒ”áƒ‘áƒ— áƒ§áƒ•áƒ”áƒšáƒáƒ¤áƒ”áƒ áƒ¡:
- áƒ áƒáƒ’áƒáƒ  áƒ›áƒáƒ«áƒ áƒáƒáƒ‘áƒ¡ áƒáƒáƒ™áƒ”áƒ¢áƒ”áƒ‘áƒ˜ Linux-áƒ˜áƒ¡ áƒ¨áƒ˜áƒ’áƒœáƒ˜áƒ—
- iptables áƒªáƒ®áƒ áƒ˜áƒšáƒ”áƒ‘áƒ˜ (filter, nat, mangle, raw)
- áƒ¯áƒáƒ­áƒ•áƒ”áƒ‘áƒ˜ (PREROUTING, INPUT, FORWARD, OUTPUT, POSTROUTING)
- Connection tracking (conntrack)
- NAT: SNAT, DNAT, MASQUERADE
- áƒ“áƒ”áƒ‘áƒáƒ’áƒ˜ áƒ›áƒáƒ’áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒáƒáƒ™áƒ”áƒ¢áƒ”áƒ‘áƒ˜áƒ¡áƒ
- áƒ áƒáƒ’áƒáƒ  áƒªáƒ•áƒšáƒ˜áƒ¡ Kubernetes-áƒ˜ iptables-áƒ¡
- áƒ áƒáƒ¢áƒáƒ› áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ”áƒœ cloud VM-áƒ”áƒ‘áƒ˜ NAT-áƒ¡
- áƒ’áƒáƒ“áƒáƒ¡áƒ•áƒšáƒ nftables-áƒ–áƒ”

áƒ›áƒáƒ“áƒ˜áƒ— firewall-áƒ˜áƒœáƒ’áƒ˜ áƒ’áƒáƒ•áƒ®áƒáƒ“áƒáƒ— áƒ¡áƒáƒ®áƒáƒšáƒ˜áƒ¡áƒ áƒ“áƒ áƒ›áƒáƒ áƒ¢áƒ˜áƒ•áƒ˜.

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 1 â€” áƒ áƒ áƒáƒ áƒ˜áƒ¡ Netfilter? (áƒáƒ®áƒ¡áƒœáƒ˜áƒšáƒ˜áƒ áƒ áƒáƒ’áƒáƒ áƒª 10 áƒ¬áƒšáƒ˜áƒ¡ áƒ‘áƒáƒ•áƒ¨áƒ•áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡)

áƒ¬áƒáƒ áƒ›áƒáƒ˜áƒ“áƒ’áƒ˜áƒœáƒ”áƒ— áƒ áƒáƒ› Linux-áƒ˜ áƒáƒ áƒ˜áƒ¡ áƒáƒ”áƒ áƒáƒáƒáƒ áƒ¢áƒ˜.

áƒ§áƒ•áƒ”áƒšáƒ áƒáƒáƒ™áƒ”áƒ¢áƒ˜ áƒáƒ áƒ˜áƒ¡ áƒ›áƒ’áƒ–áƒáƒ•áƒ áƒ˜, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ¨áƒ”áƒ“áƒ˜áƒ¡ áƒáƒ”áƒ áƒáƒáƒáƒ áƒ¢áƒ¨áƒ˜.

**Netfilter áƒáƒ áƒ˜áƒ¡ áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ”áƒ‘áƒ˜áƒ¡ checkpoint.**

áƒ˜áƒ¡ áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ¡:
- áƒ•áƒ˜áƒœ áƒ®áƒáƒ ?
- áƒ¡áƒáƒ“ áƒ›áƒ˜áƒ“áƒ˜áƒ®áƒáƒ ?
- áƒœáƒ”áƒ‘áƒáƒ“áƒáƒ áƒ—áƒ£áƒšáƒ˜áƒ áƒ¨áƒ”áƒœáƒ˜ áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ?
- áƒœáƒ”áƒ‘áƒáƒ“áƒáƒ áƒ—áƒ£áƒšáƒ˜áƒ áƒ¨áƒ”áƒœáƒ˜ áƒ’áƒáƒ¡áƒ•áƒšáƒ?
- áƒ£áƒœáƒ“áƒ áƒ’áƒáƒ“áƒáƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ“áƒ”?

**iptables/nftables áƒáƒ áƒ˜áƒ¡ áƒ’áƒ£áƒ¨áƒáƒ’áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜, áƒ áƒáƒ›áƒšáƒ”áƒ‘áƒ˜áƒª áƒ¬áƒ§áƒ•áƒ”áƒ¢áƒ”áƒœ áƒ áƒ áƒ£áƒœáƒ“áƒ áƒ›áƒáƒ®áƒ“áƒ”áƒ¡.**

### áƒáƒœáƒáƒšáƒáƒ’áƒ˜áƒ

- **Netfilter** = áƒáƒ”áƒ áƒáƒáƒáƒ áƒ¢áƒ˜áƒ¡ áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ
- **iptables** = áƒ«áƒ•áƒ”áƒšáƒ˜ áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒ˜áƒ’áƒœáƒ˜
- **nftables** = áƒáƒ®áƒáƒšáƒ˜ áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒ˜áƒ’áƒœáƒ˜
- **Connection tracking** = áƒ¬áƒáƒ áƒ¡áƒ£áƒšáƒ˜ áƒ›áƒ’áƒ–áƒáƒ•áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ®áƒ¡áƒáƒ•áƒ áƒ”áƒ‘áƒ
- **NAT** = áƒ›áƒ’áƒ–áƒáƒ•áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ®áƒ•áƒ áƒ’áƒ”áƒ˜áƒ—áƒ–áƒ” áƒ’áƒáƒ“áƒáƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ”áƒ‘áƒ

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 2 â€” áƒáƒáƒ™áƒ”áƒ¢áƒ˜áƒ¡ áƒ›áƒáƒ’áƒ–áƒáƒ£áƒ áƒáƒ‘áƒ Linux-áƒ¨áƒ˜ (áƒ«áƒáƒšáƒ˜áƒáƒœ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ•áƒáƒœáƒ˜)

áƒ§áƒ•áƒ”áƒšáƒ áƒáƒáƒ™áƒ”áƒ¢áƒ˜, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ¨áƒ”áƒ“áƒ˜áƒ¡ áƒáƒœ áƒ¢áƒáƒ•áƒ”áƒ‘áƒ¡ Linux-áƒ¡, áƒ£áƒœáƒ“áƒ áƒ’áƒáƒ˜áƒáƒ áƒáƒ¡ 5 áƒ¡áƒáƒ™áƒ•áƒáƒœáƒ«áƒ checkpoint:

1. **PREROUTING**  
2. **INPUT**  
3. **FORWARD**  
4. **OUTPUT**  
5. **POSTROUTING**
![alt text](photo2/image-31.png)
áƒ›áƒáƒ“áƒ˜áƒ— áƒ’áƒáƒ•áƒ˜áƒ’áƒáƒ— áƒ˜áƒ¡áƒ˜áƒœáƒ˜ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ˜áƒ—.

### áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ: áƒáƒáƒ™áƒ”áƒ¢áƒ˜ áƒ¡áƒ¢áƒ£áƒ›áƒ áƒáƒ‘áƒ¡ áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒáƒ¡ (Linux)

áƒáƒáƒ™áƒ”áƒ¢áƒ˜ áƒ©áƒáƒ›áƒáƒ“áƒ˜áƒ¡ áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒáƒ¨áƒ˜ (áƒ¥áƒ¡áƒ”áƒšáƒ˜áƒ¡ áƒ‘áƒáƒ áƒáƒ—áƒ˜):

#### 1. PREROUTING

áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒ áƒ”áƒ™áƒ˜áƒ—áƒ®áƒ”áƒ‘áƒ:
"áƒ£áƒœáƒ“áƒ áƒ’áƒáƒ“áƒáƒ•áƒáƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ áƒ”áƒ¡ áƒáƒ“áƒáƒ›áƒ˜áƒáƒœáƒ˜? áƒ—áƒ£ áƒ’áƒáƒáƒ’áƒ áƒ«áƒ”áƒšáƒáƒ¡ áƒ—áƒáƒ•áƒ˜áƒ¡áƒ˜ áƒ›áƒ˜áƒ›áƒ“áƒ˜áƒœáƒáƒ áƒ” áƒ’áƒ–áƒ˜áƒ—?"

**áƒáƒ¥ áƒ®áƒ“áƒ”áƒ‘áƒ DNAT.**

#### 2. INPUT

áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒ áƒ”áƒ™áƒ˜áƒ—áƒ®áƒ”áƒ‘áƒ:
"áƒ”áƒ¡ áƒ¡áƒ¢áƒ£áƒ›áƒáƒ áƒ˜ áƒ›áƒáƒ“áƒ˜áƒ¡ áƒ•áƒ˜áƒœáƒ›áƒ”áƒ¡áƒ—áƒáƒœ áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒáƒ¨áƒ˜?"

áƒ—áƒ£ áƒ“áƒ˜áƒáƒ® â†’ áƒ’áƒáƒáƒ’áƒ–áƒáƒ•áƒœáƒ”áƒ— áƒšáƒáƒ™áƒáƒšáƒ£áƒ  áƒáƒ áƒáƒªáƒ”áƒ¡áƒ–áƒ”.

#### 3. FORWARD

áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒ áƒ”áƒ™áƒ˜áƒ—áƒ®áƒ”áƒ‘áƒ:
"áƒ”áƒ¡ áƒ¡áƒ¢áƒ£áƒ›áƒáƒ áƒ˜ áƒ’áƒáƒ“áƒ˜áƒ¡ áƒ©áƒ”áƒ›áƒ¡ áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒáƒ¨áƒ˜ áƒ¡áƒ®áƒ•áƒ áƒ¨áƒ”áƒœáƒáƒ‘áƒáƒ¨áƒ˜. áƒ£áƒœáƒ“áƒ áƒ“áƒáƒ•áƒ£áƒ¨áƒ•áƒ?"

**áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ áƒ›áƒáƒ áƒ¨áƒ áƒ£áƒ¢áƒ˜áƒ–áƒáƒªáƒ˜áƒáƒ¨áƒ˜, áƒ¤áƒáƒ˜áƒ áƒ•áƒáƒšáƒ”áƒ‘áƒ¨áƒ˜, áƒ’áƒ”áƒ˜áƒ—áƒ•áƒ”áƒ˜áƒ”áƒ‘áƒ¨áƒ˜.**

#### 4. OUTPUT

áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒ áƒ”áƒ™áƒ˜áƒ—áƒ®áƒ”áƒ‘áƒ:
"áƒ•áƒ˜áƒœáƒ›áƒ” áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒáƒ¡ áƒ¨áƒ˜áƒ’áƒœáƒ˜áƒ“áƒáƒœ áƒ¡áƒ£áƒ áƒ¡ áƒ’áƒáƒ¡áƒ•áƒšáƒ. áƒ£áƒœáƒ“áƒ áƒ“áƒáƒ•áƒ£áƒ¨áƒ•áƒ?"

áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ áƒšáƒáƒ™áƒáƒšáƒ£áƒ áƒáƒ“ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ˜áƒšáƒ˜ áƒáƒáƒ™áƒ”áƒ¢áƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡.

#### 5. POSTROUTING

áƒ¡áƒ¬áƒáƒ áƒ”áƒ“ áƒ¡áƒáƒ¡áƒ¢áƒ£áƒ›áƒ áƒáƒ“áƒáƒœ áƒ’áƒáƒ¡áƒ•áƒšáƒáƒ›áƒ“áƒ”.

"áƒ£áƒœáƒ“áƒ áƒ’áƒáƒ“áƒáƒ•áƒ¬áƒ”áƒ áƒáƒ— áƒ›áƒáƒ—áƒ˜ áƒ’áƒáƒ›áƒáƒ•áƒáƒšáƒ˜ áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜?"

**áƒáƒ¥ áƒ®áƒ“áƒ”áƒ‘áƒ SNAT áƒ“áƒ MASQUERADE.**

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 3 â€” iptables áƒªáƒ®áƒ áƒ˜áƒšáƒ”áƒ‘áƒ˜ (áƒ¡áƒ£áƒáƒ”áƒ  áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ•áƒáƒœáƒ˜)

iptables áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ”áƒ áƒ—áƒ˜ áƒªáƒ®áƒ áƒ˜áƒšáƒ˜ â€” áƒ›áƒáƒ¡ áƒáƒ¥áƒ•áƒ¡ áƒ›áƒ áƒáƒ•áƒáƒšáƒ˜ áƒªáƒ®áƒ áƒ˜áƒšáƒ˜, áƒ—áƒ˜áƒ—áƒáƒ”áƒ£áƒšáƒ˜ áƒ¡áƒ®áƒ•áƒáƒ“áƒáƒ¡áƒ®áƒ•áƒ áƒ›áƒ˜áƒ–áƒœáƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡.

### 1. filter (áƒœáƒáƒ’áƒ£áƒšáƒ˜áƒ¡áƒ®áƒ›áƒ”áƒ•áƒ˜)

áƒáƒ™áƒáƒœáƒ¢áƒ áƒáƒšáƒ”áƒ‘áƒ¡ allow/deny.

**áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ:**
- áƒ¤áƒáƒ˜áƒ áƒ•áƒáƒšáƒ”áƒ‘áƒ¨áƒ˜
- INPUT áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ¨áƒ˜
- FORWARD áƒ¤áƒ˜áƒšáƒ¢áƒ áƒáƒªáƒ˜áƒáƒ¨áƒ˜

### 2. nat (Network Address Translation)

áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ¬áƒ”áƒ áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡:
- DNAT
- SNAT
- MASQUERADE

### 3. mangle

áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ áƒáƒáƒ™áƒ”áƒ¢áƒ˜áƒ¡ áƒ•áƒ”áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ¡áƒáƒªáƒ•áƒšáƒ”áƒšáƒáƒ“:
- QoS
- TTL
- TOS
- áƒáƒáƒ™áƒ”áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ™áƒ˜áƒ áƒ”áƒ‘áƒ

### 4. raw

áƒ’áƒ•áƒ”áƒ áƒ“áƒ¡ áƒ£áƒ•áƒšáƒ˜áƒ¡ connection tracking-áƒ¡.

**áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ:**
- áƒ’áƒáƒ¤áƒáƒ áƒ—áƒáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ¬áƒáƒ áƒ›áƒáƒ“áƒáƒ‘áƒ˜áƒ¡ tuning-áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡
- conntrack overhead-áƒ˜áƒ¡ áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ áƒáƒªáƒ˜áƒšáƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡

### 5. security
![alt text](photo2/image-32.png)
áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ SELinux labelling-áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡.

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 4 â€” iptables áƒ¯áƒáƒ­áƒ•áƒ”áƒ‘áƒ˜ (áƒ“áƒáƒ›áƒ¬áƒ§áƒ”áƒ‘áƒ—áƒáƒ—áƒ•áƒ˜áƒ¡ áƒ›áƒ”áƒ’áƒáƒ‘áƒ áƒ£áƒšáƒ˜ áƒ’áƒáƒœáƒ›áƒáƒ áƒ¢áƒ”áƒ‘áƒ”áƒ‘áƒ˜)

### PREROUTING

áƒáƒáƒ™áƒ”áƒ¢áƒ˜ áƒáƒ®áƒšáƒáƒ®áƒáƒœ áƒ©áƒáƒ›áƒáƒ•áƒ˜áƒ“áƒ. áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒ áƒ“áƒáƒœáƒ˜áƒ¨áƒœáƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ IP-áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ¬áƒ”áƒ áƒ (DNAT).

### INPUT

áƒáƒáƒ™áƒ”áƒ¢áƒ˜ áƒ’áƒáƒ›áƒ˜áƒ–áƒœáƒ£áƒšáƒ˜áƒ áƒáƒ› áƒ›áƒáƒœáƒ¥áƒáƒœáƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡.

### FORWARD

áƒáƒáƒ™áƒ”áƒ¢áƒ˜ áƒ’áƒáƒ“áƒ˜áƒ¡ áƒáƒ› áƒ›áƒáƒœáƒ¥áƒáƒœáƒáƒ–áƒ”.

### OUTPUT

áƒáƒáƒ™áƒ”áƒ¢áƒ˜ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ˜áƒšáƒ˜áƒ áƒáƒ› áƒ›áƒáƒœáƒ¥áƒáƒœáƒ˜áƒ¡ áƒ›áƒ˜áƒ”áƒ .

### POSTROUTING

áƒáƒáƒ™áƒ”áƒ¢áƒ˜ áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ¡ áƒ’áƒáƒ¡áƒ•áƒšáƒáƒ¡. áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒ áƒ¬áƒ§áƒáƒ áƒáƒ¡ IP-áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ•áƒšáƒ (SNAT, MASQUERADE).

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 5 â€” NAT: SNAT, DNAT, MASQUERADE (áƒ›áƒáƒ áƒ¢áƒ˜áƒ•áƒáƒ“ áƒáƒ®áƒ¡áƒœáƒ˜áƒšáƒ˜)

![alt text](photo2/image-33.png)
![alt text](photo2/image-34.png)

### 1. SNAT (Source NAT)

áƒ’áƒáƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ¬áƒ§áƒáƒ áƒáƒ¡ IP.

**áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜:**
```
áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜áƒ¡ áƒ¨áƒ˜áƒ“áƒ IP: 10.0.1.22
áƒ˜áƒœáƒ¢áƒ”áƒ áƒœáƒ”áƒ¢áƒ˜ áƒ›áƒáƒ˜áƒ—áƒ®áƒáƒ•áƒ¡: 54.10.33.1
```

SNAT áƒ’áƒáƒ“áƒáƒ¬áƒ”áƒ áƒ¡:
```
from: 10.0.1.22
to:   54.10.33.1
```

**áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ áƒ áƒáƒªáƒ:**
- áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ”áƒ‘áƒ˜ áƒáƒ˜áƒ áƒáƒ“ subnet-áƒ¨áƒ˜ áƒáƒ¦áƒ¬áƒ”áƒ•áƒ”áƒœ áƒ˜áƒœáƒ¢áƒ”áƒ áƒœáƒ”áƒ¢áƒ¡
- NAT áƒ’áƒ”áƒ˜áƒ—áƒ•áƒ”áƒ˜áƒ”áƒ‘áƒ˜
- Kubernetes egress

**áƒ®áƒ“áƒ”áƒ‘áƒ:**
POSTROUTING áƒ¯áƒáƒ­áƒ•áƒ¨áƒ˜

### 2. DNAT (Destination NAT)

áƒ’áƒáƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ“áƒáƒœáƒ˜áƒ¨áƒœáƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ IP.

**áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜:**

áƒ—áƒ¥áƒ•áƒ”áƒœ áƒáƒ°áƒ˜áƒ¢áƒ”áƒ‘áƒ—:
```
http://mycompany.com â†’ 80.80.80.10
```

áƒ›áƒáƒ’áƒ áƒáƒ› áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜ áƒ áƒ”áƒáƒšáƒ£áƒ áƒáƒ“ áƒªáƒ®áƒáƒ•áƒ áƒáƒ‘áƒ¡:
```
10.0.1.50
```

DNAT áƒ’áƒáƒ“áƒáƒ¬áƒ”áƒ áƒ¡:
```
to 10.0.1.50
```

**áƒ®áƒ“áƒ”áƒ‘áƒ:**
PREROUTING áƒ¯áƒáƒ­áƒ•áƒ¨áƒ˜

**áƒáƒ¡áƒ” áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡:**
- load balancers
- reverse proxies
- Kubernetes Services
- port-forwarding

### 3. MASQUERADE

áƒ¡áƒáƒ”áƒªáƒ˜áƒáƒšáƒ£áƒ áƒ˜ áƒ“áƒ˜áƒœáƒáƒ›áƒ˜áƒ£áƒ áƒ˜ SNAT. áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ áƒ áƒáƒªáƒ áƒ’áƒáƒ›áƒáƒ•áƒáƒš áƒ˜áƒœáƒ¢áƒ”áƒ áƒ¤áƒ”áƒ˜áƒ¡áƒ¡ áƒáƒ¥áƒ•áƒ¡ áƒ“áƒ˜áƒœáƒáƒ›áƒ˜áƒ£áƒ áƒ˜ IP (DHCP, PPPoE, cloud VM-áƒ”áƒ‘áƒ˜).

**Kubernetes áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ¡ MASQUERADE-áƒ¡ áƒ áƒáƒªáƒ Pod-áƒ”áƒ‘áƒ˜ áƒ¡áƒáƒ£áƒ‘áƒ áƒáƒ‘áƒ”áƒœ áƒ˜áƒœáƒ¢áƒ”áƒ áƒœáƒ”áƒ¢áƒ—áƒáƒœ.**

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 6 â€” Connection Tracking (conntrack)

Netfilter áƒ˜áƒ®áƒ¡áƒ”áƒœáƒ”áƒ‘áƒ¡ áƒáƒáƒ™áƒ”áƒ¢áƒ”áƒ‘áƒ¡ áƒ áƒáƒ—áƒ áƒ“áƒáƒ£áƒ¨áƒ•áƒáƒ¡:
- stateful firewall-áƒ˜áƒœáƒ’áƒ˜
- NAT áƒ—áƒáƒ áƒ’áƒ›áƒáƒœáƒ”áƒ‘áƒ˜
- áƒ¡áƒáƒáƒ˜áƒ áƒ˜áƒ¡áƒáƒ˜áƒ áƒ áƒáƒáƒ™áƒ”áƒ¢áƒ”áƒ‘áƒ˜
- áƒ›áƒ áƒáƒ•áƒáƒš-áƒáƒáƒ™áƒ”áƒ¢áƒ˜áƒáƒœáƒ˜ TCP áƒœáƒáƒ™áƒáƒ“áƒ”áƒ‘áƒ˜

**áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜áƒ¡ áƒ›áƒ“áƒ’áƒáƒ›áƒáƒ áƒ”áƒáƒ‘áƒ”áƒ‘áƒ˜:**
- NEW
- ESTABLISHED
- RELATED
- INVALID

**áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜:**

áƒ áƒáƒªáƒ áƒáƒáƒ™áƒ”áƒ¢áƒ˜ 1 áƒ“áƒáƒ¨áƒ•áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ:
```
ESTABLISHED
```
áƒ›áƒáƒ¨áƒ˜áƒœ áƒáƒáƒ™áƒ”áƒ¢áƒ˜ 2 áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒáƒ“ áƒ“áƒáƒ¨áƒ•áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ.

### conntrack áƒªáƒ®áƒ áƒ˜áƒšáƒ˜áƒ¡ áƒœáƒáƒ®áƒ•áƒ:
```bash
sudo conntrack -L
```

### áƒ’áƒáƒ­áƒ”áƒ“áƒ˜áƒšáƒ˜ áƒ©áƒáƒœáƒáƒ¬áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ:
```bash
sudo conntrack -D -p tcp --dport 443
```

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 7 â€” iptables áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜ (áƒ›áƒáƒ áƒ¢áƒ˜áƒ•áƒ˜ áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ”áƒ‘áƒ˜)

### SSH-áƒ˜áƒ¡ áƒœáƒ”áƒ‘áƒáƒ áƒ—áƒ•áƒ:
```bash
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
```

### IP-áƒ˜áƒ¡ áƒ“áƒáƒ‘áƒšáƒáƒ™áƒ•áƒ:
```bash
iptables -A INPUT -s 10.1.2.3 -j DROP
```

### áƒ’áƒáƒ›áƒáƒ•áƒáƒšáƒ˜ áƒ¢áƒ áƒáƒ¤áƒ˜áƒ™áƒ˜áƒ¡ NAT:
```bash
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```

### áƒáƒáƒ áƒ¢áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ”áƒ‘áƒ:
```bash
iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to 10.0.1.5:8080
```

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 8 â€” iptables áƒáƒáƒ™áƒ”áƒ¢áƒ˜áƒ¡ áƒœáƒáƒ™áƒáƒ“áƒ˜ (áƒ•áƒ˜áƒ–áƒ£áƒáƒšáƒ˜áƒ–áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜)

```
                         +-------------+
áƒ¨áƒ”áƒ›áƒáƒ›áƒáƒ•áƒáƒšáƒ˜ áƒáƒáƒ™áƒ”áƒ¢áƒ˜ --->    | PREROUTING  |
                         +------+------+
                                |
                        áƒ©áƒ”áƒ›áƒ—áƒ•áƒ˜áƒ¡áƒáƒ?
                        /          \
                       /            \
               +-------+             +--------+
               | INPUT |             | FORWARD|
               +-------+             +--------+
                       \            /
                        \          /
                         +--------+
                         |áƒáƒ áƒáƒªáƒ”áƒ¡áƒ˜ |
                         +--------+
                                |
                         +-------------+
                         |  OUTPUT     |
                         +------+------+
                                |
                         +-------------+
                         |POSTROUTING  |
                         +-------------+
                                |
                       áƒáƒáƒ™áƒ”áƒ¢áƒ˜ áƒ¢áƒáƒ•áƒ”áƒ‘áƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒáƒ¡
```

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 9 â€” nftables (áƒ—áƒáƒœáƒáƒ›áƒ”áƒ“áƒ áƒáƒ•áƒ” áƒ©áƒáƒœáƒáƒªáƒ•áƒšáƒ”áƒ‘áƒ)

iptables áƒ«áƒ•áƒ”áƒšáƒ˜áƒ.
nftables áƒ—áƒáƒœáƒáƒ›áƒ”áƒ“áƒ áƒáƒ•áƒ”, áƒ£áƒ¤áƒ áƒ áƒ¡áƒ¬áƒ áƒáƒ¤áƒ˜, áƒ£áƒ¤áƒ áƒ áƒ¡áƒ£áƒ¤áƒ—áƒáƒ.

**áƒ£áƒáƒ˜áƒ áƒáƒ¢áƒ”áƒ¡áƒáƒ‘áƒ”áƒ‘áƒ˜:**
- áƒœáƒáƒ™áƒšáƒ”áƒ‘áƒ˜ syscall-áƒ”áƒ‘áƒ˜
- áƒ”áƒ áƒ—áƒ˜ áƒ”áƒ áƒ—áƒ˜áƒáƒœáƒ˜ áƒ¡áƒ˜áƒœáƒ¢áƒáƒ¥áƒ¡áƒ˜
- áƒ£áƒ¤áƒ áƒ áƒ¡áƒ¬áƒ áƒáƒ¤áƒ˜ áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ›áƒ£áƒ¨áƒáƒ•áƒ”áƒ‘áƒ
- áƒ£áƒ¤áƒ áƒ áƒ›áƒáƒ¡áƒ¨áƒ¢áƒáƒ‘áƒ˜áƒ áƒ”áƒ‘áƒáƒ“áƒ˜
- áƒªáƒ•áƒšáƒ˜áƒ¡ iptables, ip6tables, arptables, ebtables-áƒ¡

**nft áƒ¬áƒ”áƒ¡áƒ˜áƒ¡ áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜:**
```bash
nft add rule inet filter input tcp dport 22 accept
```

**áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ˜áƒ:**
```bash
nft list ruleset
```

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 10 â€” áƒ áƒáƒ’áƒáƒ  áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ¡ Kubernetes iptables-áƒ¡ & nftables-áƒ¡

Kubernetes áƒ«áƒáƒšáƒ˜áƒáƒœ áƒ”áƒ§áƒ áƒ“áƒœáƒáƒ‘áƒ iptables-áƒ¡:
- Service VIP áƒ›áƒáƒ áƒ¨áƒ áƒ£áƒ¢áƒ˜áƒ–áƒáƒªáƒ˜áƒ (ClusterIP â†’ kube-proxy)
- NodePort áƒ›áƒáƒ áƒ¨áƒ áƒ£áƒ¢áƒ˜áƒ–áƒáƒªáƒ˜áƒ
- Pod-to-Pod áƒ›áƒáƒ áƒ¨áƒ áƒ£áƒ¢áƒ˜áƒ–áƒáƒªáƒ˜áƒ
- SNAT pod-áƒ”áƒ‘áƒ˜áƒ“áƒáƒœ áƒ˜áƒœáƒ¢áƒ”áƒ áƒœáƒ”áƒ¢áƒáƒ›áƒ“áƒ”
- DNS áƒ’áƒáƒ“áƒáƒ¬áƒ”áƒ áƒ
- NetworkPolicy enforcement

**áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒáƒ“:**

ClusterIP áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜ áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ¡ DNAT-áƒ¡:
```
PREROUTING â†’ DNAT â†’ Pod IP
```

**CNI áƒáƒšáƒáƒ’áƒ˜áƒœáƒ”áƒ‘áƒ˜ (Calico, Flannel, Cilium) áƒáƒ¨áƒ”áƒœáƒ”áƒ‘áƒ”áƒœ áƒ£áƒ–áƒáƒ áƒ›áƒáƒ–áƒáƒ  iptables áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒœáƒáƒ™áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ¡.**

nftables áƒœáƒ”áƒšáƒ áƒªáƒ•áƒšáƒ˜áƒ¡ iptables-áƒ¡ áƒ—áƒáƒœáƒáƒ›áƒ”áƒ“áƒ áƒáƒ•áƒ” Kubernetes áƒ“áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ‘áƒ£áƒªáƒ˜áƒ”áƒ‘áƒ¨áƒ˜.

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 11 â€” áƒ áƒ”áƒáƒšáƒ£áƒ áƒ˜ SRE áƒ“áƒ”áƒ‘áƒáƒ’áƒ˜áƒ¡ áƒ¡áƒªáƒ”áƒœáƒáƒ áƒ”áƒ‘áƒ˜

### áƒ¡áƒªáƒ”áƒœáƒáƒ áƒ˜ 1 â€” "Pod-áƒ¡ áƒáƒ  áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒ áƒ˜áƒœáƒ¢áƒ”áƒ áƒœáƒ”áƒ¢áƒ˜áƒ¡ áƒ›áƒ˜áƒ¦áƒ¬áƒ”áƒ•áƒ"

**áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ— NAT:**
```bash
iptables -t nat -L POSTROUTING -n
```

áƒ›áƒáƒ«áƒ”áƒ‘áƒœáƒ”áƒ— MASQUERADE áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜.

![alt text](photo2/image-35.png)

### áƒ¡áƒªáƒ”áƒœáƒáƒ áƒ˜ 2 â€” "Service ClusterIP áƒ›áƒ˜áƒ£áƒ¬áƒ•áƒ“áƒáƒ›áƒ”áƒšáƒ˜áƒ"

**áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ— kube-proxy áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜:**
```bash
iptables -t nat -L KUBE-SERVICES -n
```

### áƒ¡áƒªáƒ”áƒœáƒáƒ áƒ˜ 3 â€” "áƒ’áƒáƒ áƒ” áƒ¢áƒ áƒáƒ¤áƒ˜áƒ™áƒ˜ áƒáƒ  áƒáƒ¦áƒ¬áƒ”áƒ•áƒ¡ áƒœáƒáƒ£áƒ“áƒ¡"

**áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ— PREROUTING:**
```bash
iptables -t nat -L PREROUTING -n
```
![alt text](photo2/image-36.png)

### áƒ¡áƒªáƒ”áƒœáƒáƒ áƒ˜ 4 â€” "áƒ áƒáƒ¦áƒáƒª áƒáƒ’áƒ“áƒ”áƒ‘áƒ¡ áƒáƒáƒ™áƒ”áƒ¢áƒ”áƒ‘áƒ¡"

**áƒ˜áƒáƒáƒ•áƒ”áƒ— DROP áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜:**
```bash
iptables -S | grep DROP
```

**áƒáƒœ:**
```bash
iptables -L -v
```
![alt text](photo2/image-37.png)

### áƒ¡áƒªáƒ”áƒœáƒáƒ áƒ˜ 5 â€” "Firewall áƒ‘áƒšáƒáƒ™áƒáƒ•áƒ¡ áƒáƒáƒšáƒ˜áƒ™áƒáƒªáƒ˜áƒáƒ¡ áƒ›áƒ˜áƒ£áƒ®áƒ”áƒ“áƒáƒ•áƒáƒ“ áƒ˜áƒ›áƒ˜áƒ¡áƒ áƒ áƒáƒ› áƒ’áƒáƒ•áƒ®áƒ¡áƒ”áƒœáƒ˜ áƒáƒáƒ áƒ¢áƒ˜"

áƒ¨áƒ”áƒ¡áƒáƒ«áƒšáƒáƒ áƒ’áƒáƒ›áƒáƒ•áƒáƒšáƒ˜ áƒ“áƒáƒ‘áƒšáƒáƒ™áƒ˜áƒšáƒ˜áƒ:
```bash
iptables -L OUTPUT
```

áƒ¨áƒ”áƒ¡áƒáƒ«áƒšáƒáƒ FORWARD áƒ¬áƒ”áƒ¡áƒ˜ áƒ‘áƒšáƒáƒ™áƒáƒ•áƒ¡:
```bash
iptables -L FORWARD
```

### áƒ¡áƒªáƒ”áƒœáƒáƒ áƒ˜ 6 â€” "áƒ“áƒ”áƒ‘áƒáƒ’áƒ˜ áƒ¡áƒáƒ“ áƒ›áƒáƒ’áƒ“áƒ áƒáƒáƒ™áƒ”áƒ¢áƒ˜"

**áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ— TRACE:**
```bash
iptables -t raw -A PREROUTING -j TRACE
dmesg -w
```

## áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 12 â€” áƒ¡áƒáƒ¡áƒáƒ áƒ’áƒ”áƒ‘áƒšáƒ áƒ‘áƒ áƒ«áƒáƒœáƒ”áƒ‘áƒ”áƒ‘áƒ˜ (áƒ“áƒ¦áƒ” 12)

### iptables áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ˜áƒ (áƒ§áƒ•áƒ”áƒšáƒ áƒªáƒ®áƒ áƒ˜áƒšáƒ˜)
```bash
iptables -L -v -n
iptables -t nat -L -v -n
```

### áƒáƒáƒ™áƒ”áƒ¢áƒ˜áƒ¡ áƒ’áƒ–áƒ˜áƒ¡ áƒ—áƒ•áƒáƒšáƒ§áƒ£áƒ áƒ˜áƒ¡ áƒ“áƒ”áƒ•áƒœáƒ”áƒ‘áƒ
```bash
iptables -t raw -A PREROUTING -j TRACE
```
![alt text](photo2/image-38.png)

### nftables áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ˜áƒ:
```bash
nft list ruleset
```
![alt text](photo2/image-39.png)

### iptables-áƒ˜áƒ¡ áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ:
```bash
iptables -F
iptables -t nat -F
```

### iptables-áƒ˜áƒ¡ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ:
```bash
iptables-save > backup.txt
```

### iptables-áƒ˜áƒ¡ áƒáƒ¦áƒ“áƒ’áƒ”áƒœáƒ:
```bash
iptables-restore < backup.txt
```

### conntrack áƒ¡áƒ¢áƒáƒ¢áƒ˜áƒ¡áƒ¢áƒ˜áƒ™áƒ˜áƒ¡ áƒœáƒáƒ®áƒ•áƒ:
```bash
conntrack -S
```

### áƒ“áƒáƒ‘áƒšáƒáƒ™áƒ”áƒ— áƒ™áƒáƒœáƒ™áƒ áƒ”áƒ¢áƒ£áƒšáƒ˜ áƒ¬áƒ§áƒáƒ áƒ IP:
```bash
iptables -A INPUT -s 192.168.1.100 -j DROP
```

### áƒáƒáƒ áƒ¢áƒ˜áƒ¡ áƒ’áƒáƒ®áƒ¡áƒœáƒ:
```bash
iptables -A INPUT -p tcp --dport 8080 -j ACCEPT
```

### áƒ§áƒ•áƒ”áƒšáƒ áƒ¬áƒ”áƒ¡áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ:
```bash
iptables -F
iptables -X
iptables -t nat -F
iptables -t nat -X
iptables -t mangle -F
iptables -t mangle -X
```

## áƒ¨áƒ”áƒ¯áƒáƒ›áƒ”áƒ‘áƒ (áƒ“áƒ¦áƒ” 12)

áƒ“áƒ¦áƒ”áƒ¡ áƒ˜áƒ¡áƒ¬áƒáƒ•áƒšáƒ”áƒ—:
- âœ… Netfilter áƒáƒ áƒ˜áƒ¡ Linux-áƒ˜áƒ¡ firewall áƒ«áƒ áƒáƒ•áƒ
- âœ… iptables/nftables áƒáƒ áƒ˜áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ API-áƒ”áƒ‘áƒ˜
- âœ… 5 áƒ¯áƒáƒ­áƒ•áƒ˜: PREROUTING, INPUT, FORWARD, OUTPUT, POSTROUTING
- âœ… 5 áƒªáƒ®áƒ áƒ˜áƒšáƒ˜: filter, nat, mangle, raw, security
- âœ… NAT: SNAT, DNAT, MASQUERADE
- âœ… Connection tracking (conntrack)
- âœ… áƒ áƒáƒ’áƒáƒ  áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ¡ Kubernetes iptables-áƒ¡
- âœ… áƒ áƒáƒ’áƒáƒ  áƒ“áƒ”áƒ‘áƒáƒ’áƒ“áƒ”áƒ‘áƒ áƒ›áƒáƒ’áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒáƒáƒ™áƒ”áƒ¢áƒ”áƒ‘áƒ˜
- âœ… nftables áƒáƒ áƒ˜áƒ¡ áƒ—áƒáƒœáƒáƒ›áƒ”áƒ“áƒ áƒáƒ•áƒ” áƒ©áƒáƒœáƒáƒªáƒ•áƒšáƒ”áƒ‘áƒ
- âœ… áƒ áƒ”áƒáƒšáƒ£áƒ áƒ˜ SRE áƒ“áƒ”áƒ‘áƒáƒ’áƒ˜áƒ¡ áƒ¡áƒªáƒ”áƒœáƒáƒ áƒ”áƒ‘áƒ˜

**Netfilter/iptables áƒáƒ áƒ˜áƒ¡ Linux áƒ¥áƒ¡áƒ”áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ¤áƒ£áƒ«áƒ•áƒ”áƒšáƒ˜.**

**áƒáƒ›áƒ˜áƒ¡ áƒ’áƒáƒ’áƒ”áƒ‘áƒ áƒ’áƒ”áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒáƒ—:**
- áƒ“áƒ”áƒ‘áƒáƒ’áƒ˜ Kubernetes áƒ¥áƒ¡áƒ”áƒšáƒ˜áƒ¡ áƒáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ”áƒ‘áƒ˜
- áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ firewalls
- áƒ’áƒáƒ’áƒ”áƒ‘áƒ cloud NAT
- áƒ’áƒáƒ“áƒáƒ¬áƒ§áƒ•áƒ”áƒ¢áƒ connectivity áƒáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ”áƒ‘áƒ˜
- áƒáƒ¨áƒ”áƒœáƒ”áƒ‘áƒ áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒ áƒ˜áƒœáƒ¤áƒ áƒáƒ¡áƒ¢áƒ áƒ£áƒ¥áƒ¢áƒ£áƒ áƒ

## áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’áƒ˜ áƒ—áƒáƒ•áƒ”áƒ‘áƒ˜

**áƒ™áƒ£áƒ áƒ¡áƒ˜áƒ¡ áƒ’áƒáƒ’áƒ áƒ«áƒ”áƒšáƒ”áƒ‘áƒ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’ áƒ—áƒ”áƒ›áƒ”áƒ‘áƒ–áƒ”:**
- eBPF áƒ“áƒ XDP (áƒ—áƒáƒœáƒáƒ›áƒ”áƒ“áƒ áƒáƒ•áƒ” áƒáƒáƒ™áƒ”áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ›áƒ£áƒ¨áƒáƒ•áƒ”áƒ‘áƒ)
- Linux Bridge & VLAN-áƒ”áƒ‘áƒ˜
- Network Namespaces
- Container áƒ¥áƒ¡áƒ”áƒšáƒ”áƒ‘áƒ˜
- áƒ“áƒ áƒ›áƒ”áƒ¢áƒ˜...

**áƒ›áƒáƒ“áƒšáƒáƒ‘áƒ áƒ“áƒáƒ™áƒ˜áƒ—áƒ®áƒ•áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡!** ğŸ‰